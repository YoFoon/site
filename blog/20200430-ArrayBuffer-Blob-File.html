<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ArrayBuffer,Blob,FileReader 三大对象 | YoFoon&#39;s前端小站</title>
    <meta name="description" content="好好学习，努力化蛹成蝶">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/icons/logo.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/logo.png">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="apple-mobile-web-app-status-bar-style">
    
    <link rel="preload" href="/assets/css/0.styles.05cc7eb5.css" as="style"><link rel="preload" href="/assets/js/app.1274b19c.js" as="script"><link rel="preload" href="/assets/js/3.e5f6c01d.js" as="script"><link rel="preload" href="/assets/js/26.4bf8b93c.js" as="script"><link rel="preload" href="/assets/js/6.da654ace.js" as="script"><link rel="prefetch" href="/assets/js/10.92e21c8d.js"><link rel="prefetch" href="/assets/js/11.cc1411d8.js"><link rel="prefetch" href="/assets/js/12.2d961c16.js"><link rel="prefetch" href="/assets/js/13.205676dc.js"><link rel="prefetch" href="/assets/js/14.b165508a.js"><link rel="prefetch" href="/assets/js/15.486ed8f4.js"><link rel="prefetch" href="/assets/js/16.ac82d50a.js"><link rel="prefetch" href="/assets/js/17.db1abd0b.js"><link rel="prefetch" href="/assets/js/18.bd9497b5.js"><link rel="prefetch" href="/assets/js/19.081301d7.js"><link rel="prefetch" href="/assets/js/20.b8d7b737.js"><link rel="prefetch" href="/assets/js/21.086584d3.js"><link rel="prefetch" href="/assets/js/22.70d87ff4.js"><link rel="prefetch" href="/assets/js/23.cf08daab.js"><link rel="prefetch" href="/assets/js/24.07387fb5.js"><link rel="prefetch" href="/assets/js/25.4e770138.js"><link rel="prefetch" href="/assets/js/27.38076681.js"><link rel="prefetch" href="/assets/js/28.eddd4fec.js"><link rel="prefetch" href="/assets/js/29.10d1433e.js"><link rel="prefetch" href="/assets/js/30.4a707e0a.js"><link rel="prefetch" href="/assets/js/31.8677c398.js"><link rel="prefetch" href="/assets/js/32.12c7f3b9.js"><link rel="prefetch" href="/assets/js/33.932ee82b.js"><link rel="prefetch" href="/assets/js/34.d4b9aeb4.js"><link rel="prefetch" href="/assets/js/35.acc1896e.js"><link rel="prefetch" href="/assets/js/36.527e7284.js"><link rel="prefetch" href="/assets/js/37.a3f87927.js"><link rel="prefetch" href="/assets/js/38.88ddbf7a.js"><link rel="prefetch" href="/assets/js/39.fd7962a1.js"><link rel="prefetch" href="/assets/js/4.d584cd42.js"><link rel="prefetch" href="/assets/js/40.15dc2bae.js"><link rel="prefetch" href="/assets/js/41.92269fcd.js"><link rel="prefetch" href="/assets/js/42.b6a87d96.js"><link rel="prefetch" href="/assets/js/43.84bcdfb9.js"><link rel="prefetch" href="/assets/js/44.86791ad1.js"><link rel="prefetch" href="/assets/js/45.6a3fb16d.js"><link rel="prefetch" href="/assets/js/46.b5293326.js"><link rel="prefetch" href="/assets/js/47.7d80c117.js"><link rel="prefetch" href="/assets/js/48.5085aee1.js"><link rel="prefetch" href="/assets/js/49.45b201a6.js"><link rel="prefetch" href="/assets/js/5.e3a314f7.js"><link rel="prefetch" href="/assets/js/50.3ea3c47a.js"><link rel="prefetch" href="/assets/js/51.7319689a.js"><link rel="prefetch" href="/assets/js/52.c4d9b204.js"><link rel="prefetch" href="/assets/js/53.3114bf6b.js"><link rel="prefetch" href="/assets/js/54.995bca0e.js"><link rel="prefetch" href="/assets/js/55.e27397eb.js"><link rel="prefetch" href="/assets/js/56.e4513a4e.js"><link rel="prefetch" href="/assets/js/57.1159b507.js"><link rel="prefetch" href="/assets/js/58.7d58a545.js"><link rel="prefetch" href="/assets/js/59.dbd46eb1.js"><link rel="prefetch" href="/assets/js/60.92e88ec9.js"><link rel="prefetch" href="/assets/js/61.8d5cdca3.js"><link rel="prefetch" href="/assets/js/62.9af7431d.js"><link rel="prefetch" href="/assets/js/63.b41e9a05.js"><link rel="prefetch" href="/assets/js/64.4a3c4ea7.js"><link rel="prefetch" href="/assets/js/65.835613ef.js"><link rel="prefetch" href="/assets/js/66.8cd25ac9.js"><link rel="prefetch" href="/assets/js/67.2fdfc8d2.js"><link rel="prefetch" href="/assets/js/68.1a6fa670.js"><link rel="prefetch" href="/assets/js/69.24c523fc.js"><link rel="prefetch" href="/assets/js/7.0f973c56.js"><link rel="prefetch" href="/assets/js/70.afc49943.js"><link rel="prefetch" href="/assets/js/71.425d9845.js"><link rel="prefetch" href="/assets/js/72.df82cb35.js"><link rel="prefetch" href="/assets/js/73.6461ff8b.js"><link rel="prefetch" href="/assets/js/74.42fdc9ca.js"><link rel="prefetch" href="/assets/js/75.6029d9dd.js"><link rel="prefetch" href="/assets/js/76.ac5c877d.js"><link rel="prefetch" href="/assets/js/77.91697145.js"><link rel="prefetch" href="/assets/js/78.3f23eaf7.js"><link rel="prefetch" href="/assets/js/79.3390703e.js"><link rel="prefetch" href="/assets/js/8.cd0d92c8.js"><link rel="prefetch" href="/assets/js/80.14cf59a6.js"><link rel="prefetch" href="/assets/js/81.df106301.js"><link rel="prefetch" href="/assets/js/82.b9c47d41.js"><link rel="prefetch" href="/assets/js/83.7d601b24.js"><link rel="prefetch" href="/assets/js/84.8f06dfd5.js"><link rel="prefetch" href="/assets/js/85.0361ac05.js"><link rel="prefetch" href="/assets/js/86.cfc2ea02.js"><link rel="prefetch" href="/assets/js/87.04b875f6.js"><link rel="prefetch" href="/assets/js/9.cd570fc8.js"><link rel="prefetch" href="/assets/js/vendors~notification.7bcb2342.js">
    <link rel="stylesheet" href="/assets/css/0.styles.05cc7eb5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YoFoon's前端小站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge/" class="nav-link">知识</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div> <a href="https://github.com/YoFoon/FE-FACE" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge/" class="nav-link">知识</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div> <a href="https://github.com/YoFoon/FE-FACE" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>博客</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/" class="sidebar-link">快速链接链接</a></li><li><a href="/blog/20200414-hide-element.html" class="sidebar-link">点击空白处隐藏弹出元素</a></li><li><a href="/blog/20200414-intersection-observer.html" class="sidebar-link">IntersectionObserver 懒加载</a></li><li><a href="/blog/20200414-shell-push-git.html" class="sidebar-link">shell 推送 git</a></li><li><a href="/blog/20200421-wang-editor-add-upload-file.html" class="sidebar-link">wangEditor 上传附件</a></li><li><a href="/blog/20200422-ye-mian-zhu-ru-50-wan-ge-li.html" class="sidebar-link">页面注入50万个li怎么做提升性能？</a></li><li><a href="/blog/20200424-qian-duan-gong-cheng-hua.html" class="sidebar-link">前端工程化</a></li><li><a href="/blog/20200430-ArrayBuffer-Blob-File.html" class="active sidebar-link">ArrayBuffer,Blob,FileReader 三大对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/20200430-ArrayBuffer-Blob-File.html#arraybuffer-对象" class="sidebar-link">ArrayBuffer 对象</a></li><li class="sidebar-sub-header"><a href="/blog/20200430-ArrayBuffer-Blob-File.html#blob-对象" class="sidebar-link">Blob 对象</a></li><li class="sidebar-sub-header"><a href="/blog/20200430-ArrayBuffer-Blob-File.html#filereader" class="sidebar-link">FileReader</a></li><li class="sidebar-sub-header"><a href="/blog/20200430-ArrayBuffer-Blob-File.html#综合例子" class="sidebar-link">综合例子</a></li></ul></li><li><a href="/blog/20200914-tong-guo-localStorage-tong-yuan-fa-song-xin-xi.html" class="sidebar-link">通过localStorage同域发送信息</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>大数据处理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/20200428-BitMap.html" class="sidebar-link">BitMap 算法</a></li><li><a href="/blog/20200509-node-big-text.html" class="sidebar-link">NODE 大文件读写</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="arraybuffer-blob-filereader-三大对象"><a href="#arraybuffer-blob-filereader-三大对象" aria-hidden="true" class="header-anchor">#</a> ArrayBuffer,Blob,FileReader 三大对象</h1> <p>之前在做本地图片上传的时候用到了 Blob，那个时候算是刚刚接触这个东西，然后去好好的补习了一下</p> <p>然后前几天涉及到一个需求，上传一个 doc 文件，上传完之后要对其解析，然后在页面上展示出来</p> <p>于是找到了一个插件，叫做<code>mammoth</code>,这个插件就可以对 doc 文件进行解析,然后拿到具体内容</p> <p>但是有一个小小的问题就是这个插件不能直接传一个 http 的 url 进行解析，需要传 ArrayBuffer 或者本地的 url</p> <p>所以这个时候又想到了 Blob 这个东西,get 请求用 blob 格式把文件请求下来，然后生成一个 FileReader 对象，然后用 ArrayBuffer 格式去读一下这个文件，最后传到<code>mammoth</code>中</p> <p>既然涉及到了这么多，那么就来总结一下这三个对象吧</p> <h2 id="arraybuffer-对象"><a href="#arraybuffer-对象" aria-hidden="true" class="header-anchor">#</a> ArrayBuffer 对象</h2> <p><code>ArrayBuffer</code>对象是在<code>ES6</code>才写进标准的，来表示一段二进制的数据，用来模拟内存里面的数据。通过这个对象，js 可以读写二进制数据。可以看做是内存数据的表达</p> <p>浏览器原生提供了<code>ArrayBuffer()</code>构造函数，用来生成实例。接受一个整数作为参数，表示这段二进制数据占用多少字节</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 占用8个字节的实例对象</span>
<span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token comment">// 实例可以通过 .byteLength 来或者当前实例占用的内存长度，其单位是 字节</span>
buffer<span class="token punctuation">.</span>byteLength <span class="token comment">// 8</span>
<span class="token comment">// 实例有一个 slice 方法，用来复制一部分内存，用法和字符串的 slice 一致</span>
<span class="token keyword">const</span> bufferCopy <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 复制原来的实例</span>
</code></pre></div><h2 id="blob-对象"><a href="#blob-对象" aria-hidden="true" class="header-anchor">#</a> Blob 对象</h2> <p><code>Blob</code>对象表示一个二进制文件的数据内容，比如一个图片文件的内容就可以通过<code>Blob</code>对象读写。它通常用来读写文件，它的名字是 Binary Large Object （二进制大型对象）的缩写。它与 ArrayBuffer 的区别在于，它用于操作二进制文件，而 ArrayBuffer 用于操作内存。</p> <p>浏览器原生提供<code>Blob()</code>构造函数，用来生成实例对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>array <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>Blob 构造函数接受两个参数。第一个参数是数组，成员是字符串或二进制对象，表示新生成的 Blob 实例对象的内容；第二个参数是可选的，是一个配置对象，目前只有一个属性 type。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 实例对象myBlob包含的是字符串。生成实例的时候，数据类型指定为text/html。</span>
<span class="token keyword">const</span> htmlFragment <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&lt;a id=&quot;a&quot;&gt;&lt;b id=&quot;b&quot;&gt;hey!&lt;/b&gt;&lt;/a&gt;'</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> myBlob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>htmlFragment<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'text/html'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Blob 保存 JSON 数据。</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> hello<span class="token punctuation">:</span> <span class="token string">'world'</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 实例有两个属性，分别为 size 和 type，分别返回实例数据的大小和类型</span>
myBlob<span class="token punctuation">.</span>size <span class="token comment">// 32</span>
myBlob<span class="token punctuation">.</span>type <span class="token comment">// text/html</span>

<span class="token comment">// 实例有一个 slice 方法，用来复制数据，返回的也是一个Blog数据</span>
<span class="token comment">// slice方法有三个参数，都是可选的。它们依次是起始的字节位置（默认为0）、结束的字节位置（默认为size属性的值，该位置本身将不包含在拷贝的数据之中）、新实例的数据类型（默认为空字符串）。</span>
myBlob<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> contentType<span class="token punctuation">)</span>
</code></pre></div><h3 id="blob-实操"><a href="#blob-实操" aria-hidden="true" class="header-anchor">#</a> Blob 实操</h3> <h4 id="获取文件信息"><a href="#获取文件信息" aria-hidden="true" class="header-anchor">#</a> 获取文件信息</h4> <p>通过<code>&lt;input type=&quot;file&quot;&gt;</code>,可以让用户选来选取文件，返回一个<code>FileList</code>对象，该对象是一个类似数组的成员，每个成员都是一个<a href="#filereader"><code>File</code></a>实例对象。<code>File</code>实例对象是一个特殊的<code>Blob</code>实例，增加了<code>name</code>和<code>lastModifiedDate</code>属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// HTML 代码如下</span>
<span class="token punctuation">;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> accept<span class="token operator">=</span><span class="token string">&quot;image/*&quot;</span> multiple onchange<span class="token operator">=</span><span class="token string">&quot;fileInfo(this.files)&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token keyword">function</span> <span class="token function">fileInfo</span><span class="token punctuation">(</span><span class="token parameter">files</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> f <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      f<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token comment">// 文件名，不含路径</span>
      f<span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token operator">/</span> 文件大小，Blob 实例属性
      f<span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token operator">/</span> 文件类型，Blob 实例属性
      f<span class="token punctuation">.</span>lastModifiedDate <span class="token operator">/</span><span class="token operator">/</span> 文件的最后修改时间
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="下载-blob-文件"><a href="#下载-blob-文件" aria-hidden="true" class="header-anchor">#</a> 下载 Blob 文件</h4> <p>在请求的时候，如果指定<code>responseType</code>属性为<code>blob</code>，下载下来的就是一个<code>Blob</code>对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getBlob</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
  xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'blob'</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="生成-url"><a href="#生成-url" aria-hidden="true" class="header-anchor">#</a> 生成 URL</h4> <p>使用<code>URL.createObjectURL()</code>方法，针对<code>Blob</code>对象生成一个临时<code>URL</code>，以便于某些<code>API</code>使用。这个<code>URL</code>以<code>blob://</code>开头，表明对应一个<code>Blob</code>对象，协议头后面是一个识别符，用来唯一对应内存里面的<code>Blob</code>对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// HTML 代码如下</span>
<span class="token punctuation">;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> accept<span class="token operator">=</span><span class="token string">&quot;image/*&quot;</span> multiple onchange<span class="token operator">=</span><span class="token string">&quot;fileInfo(this.files)&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token keyword">function</span> <span class="token function">fileInfo</span><span class="token punctuation">(</span><span class="token parameter">files</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">100</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token comment">//URL.revokeObjectURL() 静态方法用来释放一个之前已经存在的、通过调用 URL.createObjectURL() 创建的 URL 对象。当你结束使用某个 URL 对象之后，应该通过调用这个方法来让浏览器知道不用在内存中继续保留对这个文件的引用了。</span>
      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>src<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码通过为拖放的图片文件生成一个 URL，产生它们的缩略图，从而使得用户可以预览选择的文件。</p> <p>注意：<code>Blob URL</code>只对<code>GET</code>请求有效，由于<code>Blob URL</code>就是普通<code>URL</code>，因此可以下载。</p> <h2 id="filereader"><a href="#filereader" aria-hidden="true" class="header-anchor">#</a> FileReader</h2> <p><code>FileReader</code>对象用于读取<code>File</code>对象或<code>Blob</code>对象所包含的文件内容。</p> <p>浏览器原生提供一个<code>FileReader</code>构造函数，用来生成<code>FileReader</code>实例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="实例属性"><a href="#实例属性" aria-hidden="true" class="header-anchor">#</a> 实例属性</h3> <ul><li>reader.error：读取文件时产生的错误对象</li> <li>reader.readyState：读取文件时的当前状态。0 表示尚未加载任何数据，1 表示数据正在加载，2 表示加载完成。</li> <li>reader.result：读取完成后的文件内容，有可能是字符串，也可能是一个 ArrayBuffer 实例。</li> <li>reader.onabort：abort 事件（用户终止读取操作）的监听函数。</li> <li>reader.onerror：error 事件（读取错误）的监听函数。</li> <li>reader.onload：load 事件（读取操作完成）的监听函数，通常在这个函数里面使用 result 属性，拿到文件内容。</li> <li>reader.onloadstart：loadstart 事件（读取操作开始）的监听函数。</li> <li>reader.onloadend：loadend 事件（读取操作结束）的监听函数</li> <li>reader.onprogress：progress 事件（读取操作进行中）的监听函数。</li></ul> <h3 id="实例方法"><a href="#实例方法" aria-hidden="true" class="header-anchor">#</a> 实例方法</h3> <ul><li>reader.abort()：终止读取操作，readyState 属性将变成 2。</li> <li>reader.readAsArrayBuffer()：以<code>ArrayBuffer</code>的格式读取文件，result 属性将返回一个<code>ArrayBuffer</code>实例。</li> <li>reader.readAsBinaryString()：读取完成后，result 属性将返回原始的二进制字符串。</li> <li>reader.readAsDataURL()：读取完成后，result 属性将返回一个 Data URL 格式（Base64 编码）的字符串，代表文件内容。对于图片文件，这个字符串可以用于<code>&lt;img&gt;</code>元素的 src 属性。注意，这个字符串不能直接进行 Base64 解码，必须把前缀 data:<em>/</em>;base64,从字符串里删除以后，再进行解码。</li> <li>reader.readAsText()：读取完成后，result 属性将返回文件内容的文本字符串。该方法的第一个参数是代表文件的<code>Blob</code>实例，第二个参数是可选的，表示文本编码，默认为 UTF-8。</li></ul> <h4 id="监听-load-的例子"><a href="#监听-load-的例子" aria-hidden="true" class="header-anchor">#</a> 监听 load 的例子</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// HTML 代码如下</span>
<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> onchange<span class="token operator">=</span><span class="token string">&quot;onChange(event)&quot;</span><span class="token operator">&gt;</span>

<span class="token keyword">function</span> <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> file <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="readastext-的例子"><a href="#readastext-的例子" aria-hidden="true" class="header-anchor">#</a> readAsText 的例子</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// HTML 代码如下</span>
<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">'file'</span> onchange<span class="token operator">=</span><span class="token string">'readFile(this.files[0])'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>input<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>pre id<span class="token operator">=</span><span class="token string">'output'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">&gt;</span>

<span class="token keyword">function</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
  reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> text <span class="token operator">=</span> reader<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    <span class="token keyword">var</span> out <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'output'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  reader<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="readasarraybuffer"><a href="#readasarraybuffer" aria-hidden="true" class="header-anchor">#</a> readAsArrayBuffer</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// HTML 代码如下</span>
<span class="token punctuation">;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> onchange<span class="token operator">=</span><span class="token string">&quot;typeFile(this.files[0])&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token keyword">function</span> <span class="token function">typeFile</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 文件开头的四个字节，生成一个 Blob 对象</span>
  <span class="token keyword">var</span> slice <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 读取这四个字节</span>
  reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span>
  reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> buffer <span class="token operator">=</span> reader<span class="token punctuation">.</span>result
    <span class="token comment">// 将这四个字节的内容，视作一个32位整数</span>
    <span class="token keyword">var</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>
    <span class="token keyword">var</span> magic <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getUint32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token comment">// 根据文件的前四个字节，判断它的类型</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>magic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">0x89504e47</span><span class="token punctuation">:</span>
        file<span class="token punctuation">.</span>verified_type <span class="token operator">=</span> <span class="token string">'image/png'</span>
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token number">0x47494638</span><span class="token punctuation">:</span>
        file<span class="token punctuation">.</span>verified_type <span class="token operator">=</span> <span class="token string">'image/gif'</span>
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token number">0x25504446</span><span class="token punctuation">:</span>
        file<span class="token punctuation">.</span>verified_type <span class="token operator">=</span> <span class="token string">'application/pdf'</span>
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token number">0x504b0304</span><span class="token punctuation">:</span>
        file<span class="token punctuation">.</span>verified_type <span class="token operator">=</span> <span class="token string">'application/zip'</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>name<span class="token punctuation">,</span> file<span class="token punctuation">.</span>verified_type<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="综合例子"><a href="#综合例子" aria-hidden="true" class="header-anchor">#</a> 综合例子</h2> <p>那么最终让我们以一个实际的例子来结束吧，用<code>mammoth</code>对 http 的 url 进行解析</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// readFile.js</span>
<span class="token keyword">import</span> mammoth <span class="token keyword">from</span> <span class="token string">'mammoth/mammoth.browser.min'</span>

<span class="token comment">// 获取文件的blob对象</span>
<span class="token keyword">const</span> <span class="token function-variable function">getFileBlob</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'blob'</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function-variable function">readFile</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取文件的blob对象</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getBlob</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 读取完成后result属性将返回一个 ArrayBuffer 实例</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onloadend</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> arrayBuffer <span class="token operator">=</span> reader<span class="token punctuation">.</span>result
      <span class="token comment">// mammoth解析doc文件</span>
      mammoth<span class="token punctuation">.</span><span class="token function">convertToHtml</span><span class="token punctuation">(</span><span class="token punctuation">{</span> arrayBuffer<span class="token punctuation">:</span> arrayBuffer <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resultObject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          value<span class="token punctuation">:</span> resultObject<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
          code<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        valve<span class="token punctuation">:</span> e<span class="token punctuation">,</span>
        code<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// component.js</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>innerHtml<span class="token punctuation">,</span> setInnerHtml<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span>docUrl<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setInnerHtml</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>docUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>docUrl<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span>div dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> __html<span class="token punctuation">:</span> innerHtml <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/YoFoon/FE-FACE/edit/master/blog/20200430-ArrayBuffer-Blob-File.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/20200424-qian-duan-gong-cheng-hua.html" class="prev">
          前端工程化
        </a></span> <span class="next"><a href="/blog/20200914-tong-guo-localStorage-tong-yuan-fa-song-xin-xi.html">
          通过localStorage同域发送信息
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.1274b19c.js" defer></script><script src="/assets/js/3.e5f6c01d.js" defer></script><script src="/assets/js/26.4bf8b93c.js" defer></script><script src="/assets/js/6.da654ace.js" defer></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>BitMap 算法 | YoFoon&#39;s前端小站</title>
    <meta name="description" content="好好学习，努力化蛹成蝶">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/icons/logo.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/logo.png">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="apple-mobile-web-app-status-bar-style">
    
    <link rel="preload" href="/assets/css/0.styles.05cc7eb5.css" as="style"><link rel="preload" href="/assets/js/app.1274b19c.js" as="script"><link rel="preload" href="/assets/js/3.e5f6c01d.js" as="script"><link rel="preload" href="/assets/js/25.4e770138.js" as="script"><link rel="preload" href="/assets/js/6.da654ace.js" as="script"><link rel="prefetch" href="/assets/js/10.92e21c8d.js"><link rel="prefetch" href="/assets/js/11.cc1411d8.js"><link rel="prefetch" href="/assets/js/12.2d961c16.js"><link rel="prefetch" href="/assets/js/13.205676dc.js"><link rel="prefetch" href="/assets/js/14.b165508a.js"><link rel="prefetch" href="/assets/js/15.486ed8f4.js"><link rel="prefetch" href="/assets/js/16.ac82d50a.js"><link rel="prefetch" href="/assets/js/17.db1abd0b.js"><link rel="prefetch" href="/assets/js/18.bd9497b5.js"><link rel="prefetch" href="/assets/js/19.081301d7.js"><link rel="prefetch" href="/assets/js/20.b8d7b737.js"><link rel="prefetch" href="/assets/js/21.086584d3.js"><link rel="prefetch" href="/assets/js/22.70d87ff4.js"><link rel="prefetch" href="/assets/js/23.cf08daab.js"><link rel="prefetch" href="/assets/js/24.07387fb5.js"><link rel="prefetch" href="/assets/js/26.4bf8b93c.js"><link rel="prefetch" href="/assets/js/27.38076681.js"><link rel="prefetch" href="/assets/js/28.eddd4fec.js"><link rel="prefetch" href="/assets/js/29.10d1433e.js"><link rel="prefetch" href="/assets/js/30.4a707e0a.js"><link rel="prefetch" href="/assets/js/31.8677c398.js"><link rel="prefetch" href="/assets/js/32.12c7f3b9.js"><link rel="prefetch" href="/assets/js/33.932ee82b.js"><link rel="prefetch" href="/assets/js/34.d4b9aeb4.js"><link rel="prefetch" href="/assets/js/35.acc1896e.js"><link rel="prefetch" href="/assets/js/36.527e7284.js"><link rel="prefetch" href="/assets/js/37.a3f87927.js"><link rel="prefetch" href="/assets/js/38.88ddbf7a.js"><link rel="prefetch" href="/assets/js/39.fd7962a1.js"><link rel="prefetch" href="/assets/js/4.d584cd42.js"><link rel="prefetch" href="/assets/js/40.15dc2bae.js"><link rel="prefetch" href="/assets/js/41.92269fcd.js"><link rel="prefetch" href="/assets/js/42.b6a87d96.js"><link rel="prefetch" href="/assets/js/43.84bcdfb9.js"><link rel="prefetch" href="/assets/js/44.86791ad1.js"><link rel="prefetch" href="/assets/js/45.6a3fb16d.js"><link rel="prefetch" href="/assets/js/46.b5293326.js"><link rel="prefetch" href="/assets/js/47.7d80c117.js"><link rel="prefetch" href="/assets/js/48.5085aee1.js"><link rel="prefetch" href="/assets/js/49.45b201a6.js"><link rel="prefetch" href="/assets/js/5.e3a314f7.js"><link rel="prefetch" href="/assets/js/50.3ea3c47a.js"><link rel="prefetch" href="/assets/js/51.7319689a.js"><link rel="prefetch" href="/assets/js/52.c4d9b204.js"><link rel="prefetch" href="/assets/js/53.3114bf6b.js"><link rel="prefetch" href="/assets/js/54.995bca0e.js"><link rel="prefetch" href="/assets/js/55.e27397eb.js"><link rel="prefetch" href="/assets/js/56.e4513a4e.js"><link rel="prefetch" href="/assets/js/57.1159b507.js"><link rel="prefetch" href="/assets/js/58.7d58a545.js"><link rel="prefetch" href="/assets/js/59.dbd46eb1.js"><link rel="prefetch" href="/assets/js/60.92e88ec9.js"><link rel="prefetch" href="/assets/js/61.8d5cdca3.js"><link rel="prefetch" href="/assets/js/62.9af7431d.js"><link rel="prefetch" href="/assets/js/63.b41e9a05.js"><link rel="prefetch" href="/assets/js/64.4a3c4ea7.js"><link rel="prefetch" href="/assets/js/65.835613ef.js"><link rel="prefetch" href="/assets/js/66.8cd25ac9.js"><link rel="prefetch" href="/assets/js/67.2fdfc8d2.js"><link rel="prefetch" href="/assets/js/68.1a6fa670.js"><link rel="prefetch" href="/assets/js/69.24c523fc.js"><link rel="prefetch" href="/assets/js/7.0f973c56.js"><link rel="prefetch" href="/assets/js/70.afc49943.js"><link rel="prefetch" href="/assets/js/71.425d9845.js"><link rel="prefetch" href="/assets/js/72.df82cb35.js"><link rel="prefetch" href="/assets/js/73.6461ff8b.js"><link rel="prefetch" href="/assets/js/74.42fdc9ca.js"><link rel="prefetch" href="/assets/js/75.6029d9dd.js"><link rel="prefetch" href="/assets/js/76.ac5c877d.js"><link rel="prefetch" href="/assets/js/77.91697145.js"><link rel="prefetch" href="/assets/js/78.3f23eaf7.js"><link rel="prefetch" href="/assets/js/79.3390703e.js"><link rel="prefetch" href="/assets/js/8.cd0d92c8.js"><link rel="prefetch" href="/assets/js/80.14cf59a6.js"><link rel="prefetch" href="/assets/js/81.df106301.js"><link rel="prefetch" href="/assets/js/82.b9c47d41.js"><link rel="prefetch" href="/assets/js/83.7d601b24.js"><link rel="prefetch" href="/assets/js/84.8f06dfd5.js"><link rel="prefetch" href="/assets/js/85.0361ac05.js"><link rel="prefetch" href="/assets/js/86.cfc2ea02.js"><link rel="prefetch" href="/assets/js/87.04b875f6.js"><link rel="prefetch" href="/assets/js/9.cd570fc8.js"><link rel="prefetch" href="/assets/js/vendors~notification.7bcb2342.js">
    <link rel="stylesheet" href="/assets/css/0.styles.05cc7eb5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YoFoon's前端小站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge/" class="nav-link">知识</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div> <a href="https://github.com/YoFoon/FE-FACE" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge/" class="nav-link">知识</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div> <a href="https://github.com/YoFoon/FE-FACE" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>博客</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/" class="sidebar-link">快速链接链接</a></li><li><a href="/blog/20200414-hide-element.html" class="sidebar-link">点击空白处隐藏弹出元素</a></li><li><a href="/blog/20200414-intersection-observer.html" class="sidebar-link">IntersectionObserver 懒加载</a></li><li><a href="/blog/20200414-shell-push-git.html" class="sidebar-link">shell 推送 git</a></li><li><a href="/blog/20200421-wang-editor-add-upload-file.html" class="sidebar-link">wangEditor 上传附件</a></li><li><a href="/blog/20200422-ye-mian-zhu-ru-50-wan-ge-li.html" class="sidebar-link">页面注入50万个li怎么做提升性能？</a></li><li><a href="/blog/20200424-qian-duan-gong-cheng-hua.html" class="sidebar-link">前端工程化</a></li><li><a href="/blog/20200430-ArrayBuffer-Blob-File.html" class="sidebar-link">ArrayBuffer,Blob,FileReader 三大对象</a></li><li><a href="/blog/20200914-tong-guo-localStorage-tong-yuan-fa-song-xin-xi.html" class="sidebar-link">通过localStorage同域发送信息</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>大数据处理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/20200428-BitMap.html" class="active sidebar-link">BitMap 算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/20200428-BitMap.html#什么是bitmap" class="sidebar-link">什么是BitMap</a></li><li class="sidebar-sub-header"><a href="/blog/20200428-BitMap.html#位运算" class="sidebar-link">位运算</a></li><li class="sidebar-sub-header"><a href="/blog/20200428-BitMap.html#实现" class="sidebar-link">实现</a></li><li class="sidebar-sub-header"><a href="/blog/20200428-BitMap.html#大数据排序" class="sidebar-link">大数据排序</a></li><li class="sidebar-sub-header"><a href="/blog/20200428-BitMap.html#扩展阅读-布隆过滤器" class="sidebar-link">扩展阅读(布隆过滤器)</a></li><li class="sidebar-sub-header"><a href="/blog/20200428-BitMap.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/blog/20200509-node-big-text.html" class="sidebar-link">NODE 大文件读写</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="bitmap-算法"><a href="#bitmap-算法" aria-hidden="true" class="header-anchor">#</a> BitMap 算法</h1> <p>用一个问题来引出这次的文章</p> <blockquote><p>10亿个无序整数，已知最大值为15亿，请对这10亿个数进行排序(假设无重复)。现要在32位机器上对其排列，并且内存限制为2G。</p></blockquote> <p>分析一下问题，10G的文件，只有2G的内存，显然不能一次性的把数据直接读进内存中直接排序。</p> <p>那么，还有什么其他办法呢？这里就可以使用<code>BitMap</code></p> <h2 id="什么是bitmap"><a href="#什么是bitmap" aria-hidden="true" class="header-anchor">#</a> 什么是BitMap</h2> <p>所谓的BitMap就是用一个bit位来标记某个元素对应的Value，而Key即是该元素。由于采用了Bit为单位来存储数据，因此在存储空间方面，可以大大节省。</p> <p>来看一个简单具体的例子，假设我们要对0-7内的5个元素(4,7,2,5,3)排序（这里假设这些元素没有重复）。那么我们就可以采用BitMap的方法来达到排序的目的。要表示8个数，我们就只需要8个Bit（1Bytes），首先我们开辟1Byte的空间，将这些空间的所有Bit位都置为0</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1 Bytes 来表示 8 为 Bit</span>
<span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span>
</code></pre></div><p>然后遍历这5个元素，首先第一个元素是4，那么就把4对应的位置为1，因为是从零开始的，所以要把第五位置为1：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1 Bytes 来表示 8 为 Bit</span>
<span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span>
</code></pre></div><p>然后处理第二个元素7，将第八位置为1,接着处理第三个元素，一直到最后处理完所有的元素，将相应的位置为1，对应状态如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1 Bytes 来表示 8 为 Bit</span>
<span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span>
</code></pre></div><p>然后我们现在遍历一遍Bit区域，将该位是一的位的编号输出（2，3，4，5，7），这样就达到了排序的目的。</p> <p>用简单的js代码实现以下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">function</span> <span class="token function">FindClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用来存储数据</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// //先初始化为0</span>
    bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">addMember</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//添加</span>
    bytes<span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">isExist</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//判断是否存在</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>bytes<span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getBytes</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> bytes<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> findClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FindClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 把对应位置标记为1</span>
  findClass<span class="token punctuation">.</span><span class="token function">addMember</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> bytes <span class="token operator">=</span> findClass<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// [2,3,4,5,7]</span>
</code></pre></div><p>那么如果扩充到一亿个整数排序呢，一个整数算作4个字节，4亿个字节大概需要占用380M的内存空间</p> <p>想象一下有8个路灯,编号从1-8,其中2,5,7,8是亮的,其余不亮.</p> <p>如果二进制来表示，且用1代表亮，0代表不亮，那么这个二进制表现为<code>01001011</code></p> <p>1个整数有4个Bytes, 也就是32Bit,就可以代表32盏灯</p> <p>改造一下上面的isExit方法</p> <p>设一个<code>value</code>，其初始化为0</p> <p>当 add() 传进来参数是<code>0</code>的时候, 就把<code>value</code>的第1位设置为<code>1</code>, 如下所示</p> <blockquote><p>00000000 00000000 00000000 00000001
此时<code>value</code>的值为 1</p></blockquote> <p>再加 3, 把<code>value</code>的第4位设置为<code>1</code></p> <blockquote><p>00000000 00000000 00000000 00001001
此时 <code>value</code>的值为 9 ,9就表示0和3都存在</p></blockquote> <p>可以得出结论, 32bit 可以判断<code>0-31</code>是否存在</p> <p>如果创建一个大小为10的数组,数组里存储整数,那么这个数组就可以表示代表<code>0-319</code>是否存在</p> <ul><li>bytes[0] 表示0-31是否存在</li> <li>bytes[1] 表示32-63是否存在</li> <li>....</li> <li>bytes[9] 表示288-319是否存在</li></ul> <p><strong>通过这种方式,可以把空间的使用降低为原来的<code>1/32</code></strong></p> <p>存储一个亿数据的存在状态,就只需要10M+的空间</p> <h2 id="位运算"><a href="#位运算" aria-hidden="true" class="header-anchor">#</a> 位运算</h2> <p>这种方式涉及到了位运算,简单了解下:</p> <h3 id="按位与"><a href="#按位与" aria-hidden="true" class="header-anchor">#</a> 按位与 &amp;</h3> <p>规则: 两个整数进行&amp;与运算,相同二进制的数字如果都是1, 则结果为1,有一个为0,则为0</p> <ul><li>1 &amp; 1 = 1</li> <li>1 &amp; 0 = 0
-0 &amp; 0 = 0</li></ul> <h3 id="按位或"><a href="#按位或" aria-hidden="true" class="header-anchor">#</a> 按位或 |</h3> <p>规则: 两个整数进行|或运算,相同二进制的数字如果有一个为1, 则结果为1,都是0,则为0</p> <ul><li>1 | 1 = 1</li> <li>1 | 0 = 1</li> <li>0 | 0 = 0</li></ul> <h3 id="左移"><a href="#左移" aria-hidden="true" class="header-anchor">#</a> 左移 &lt;&lt;</h3> <p>规则: 二进制向左移动n位, 在后面添加n个0</p> <ul><li>3&lt;&lt;1 = 0011 -&gt; 0110, 得到了 6</li> <li>3&lt;&lt;2 = 0011 -&gt; 1100, 得到了 12</li></ul> <h2 id="实现"><a href="#实现" aria-hidden="true" class="header-anchor">#</a> 实现</h2> <p>按照上面的思路,重新设计一个查找类, 实现<code>addMember</code>和<code>isExist</code>方法，用更快的速度，更少的内存</p> <h3 id="addmember"><a href="#addmember" aria-hidden="true" class="header-anchor">#</a> addMember</h3> <p><code>0-100</code>只需要4个整数, 4 * 32 &gt; 100 来表示是否存在,创建一个大小为4的数组</p> <p>思路:</p> <ul><li>先用<code>member/32</code>,确定<code>member</code>在数组里的索引<code>arr_index</code>,比如<code>33</code>就存在<code>arr[1]</code>中</li> <li>然后用<code>member%32</code>，确定在整数的哪个二进制位进行操作<code>bit_index</code>, 比如<code>33</code>就存在 <code>arr[1]</code> 的下标为<code>1</code>的bit上</li> <li>最后执行<code>bit_arr[arr_index] = bit_arr[arr_index] | 1&lt;&lt;bit_index</code>用来对应的bit进行赋值</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">addMember</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">member</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 决定在数组中的索引</span>
  <span class="token keyword">var</span> arr_index <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>member <span class="token operator">/</span> <span class="token number">32</span><span class="token punctuation">)</span> 
  <span class="token comment">// 决定在整数的32个bit位的哪一位上</span>
  <span class="token keyword">var</span> bit_index <span class="token operator">=</span> member <span class="token operator">%</span> <span class="token number">32</span> 
  <span class="token comment">// 对应的bit进行赋值</span>
  bit_arr<span class="token punctuation">[</span>arr_index<span class="token punctuation">]</span> <span class="token operator">=</span> bit_arr<span class="token punctuation">[</span>arr_index<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> bit_index
  <span class="token comment">//                 00000000 00000000 00000000 00000000 | 1 &lt;&lt; 1</span>
  <span class="token comment">// 1 &lt;&lt; 1 相当于    00000001 &lt;&lt; 1 -&gt; 00000010</span>
  <span class="token comment">// 所以上面计算得到   00000000 00000000 00000000 00000010</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="isexist"><a href="#isexist" aria-hidden="true" class="header-anchor">#</a> isExist</h3> <p>思路</p> <ul><li>先用<code>member/32</code>,确定<code>member</code>在数组里的索引<code>arr_index</code></li> <li>然后用<code>member%32</code>,确定在整数的哪个二进制位进行操作<code>bit_index</code></li> <li>最后执行<code>bit_arr[arr_index] &amp; 1&lt;&lt;bit_index</code>,如果结果为<code>1</code>,就说明<code>member</code>存在</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">isExist</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">member</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 决定在数组中的索引</span>
  <span class="token keyword">var</span> arr_index <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>member<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span> 
  <span class="token comment">// 决定在整数的32个bit位的哪一位上</span>
  <span class="token keyword">var</span> bit_index <span class="token operator">=</span> member <span class="token operator">%</span> <span class="token number">32</span> 
  <span class="token keyword">var</span> value <span class="token operator">=</span> bit_arr<span class="token punctuation">[</span>arr_index<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> bit_index
  <span class="token keyword">return</span> value <span class="token operator">===</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这种数据结构基于位做映射，能够用很少的内存存储数据，和数组不同，它只能存储表示某个数是否存在，可以用于大数据去重，大数据排序，两个集合取交集。</p> <p>BitMap在处理大数据时才有优势，而且要求数据集紧凑，如果要处理的数只有3个：1，1000，100000，那么空间利用率太低了，最大的值决定了BitMap要用多少内存。</p> <h2 id="大数据排序"><a href="#大数据排序" aria-hidden="true" class="header-anchor">#</a> 大数据排序</h2> <p>拿出一开始提到的问题</p> <p>BitMap存储最大值为15亿的集合，只需要180M 的空间，空间使用完全可以接受，</p> <p>至于速度，存储和比较过程中的位运算速度都非常快，第一次遍历，将10亿个数都放入到BitMap中，</p> <p>第二次，从0到15亿进行遍历，如果在BitMap，则输出该数值，这样经过两次遍历，就可以将如此多的数据排序。</p> <h3 id="再来一个问题"><a href="#再来一个问题" aria-hidden="true" class="header-anchor">#</a> 再来一个问题</h3> <p>在2.5亿个整数中找出不重复的整数，注，内存不足以容纳这2.5亿个整数</p> <p>采用2-Bitmap（每个数分配2bit，00表示不存在，01表示出现一次，10表示多次，11无意义）</p> <p>共需内存<code>2^32 * 2 bit</code>=<code>1GB</code>内存</p> <p>然后扫描这2.5亿个整数，查看Bitmap中相对应位,如果是00变01，01变10，10保持不变。</p> <p>所描完事后，查看bitmap，把对应位是01的整数输出即可。</p> <h2 id="扩展阅读-布隆过滤器"><a href="#扩展阅读-布隆过滤器" aria-hidden="true" class="header-anchor">#</a> 扩展阅读(布隆过滤器)</h2> <p>前面所讲的BitMap的确很厉害，可以，却有着很强的局限性，BitMap只能用来处理整数，无法处理字符串，假设让你写一个强大的爬虫，每天爬取数以亿计的网页，那么你就需要一种数据结构，能够存储你已经爬取过的 url ，这样，才不至于重复爬取。</p> <p>你可能会想到使用hash函数对url进行处理，转成整数，这样，似乎又可以使用BitMap了，但这样还是会有问题。假设BitMap能够映射的最大值是 M ，一个url的hash值需要对M求模，这样，就会产生冲突，而且随着存储数据的增多，冲突率会越来越大。</p> <p>布隆过滤器的思想非常简单，其基本思路和BitMap是一样的，可以把布隆过滤器看做是 BitMap的扩展。为了解决冲突率，布隆过滤器要求使用k个 hash函数，新增一个 key时，把 key散列成 k 个整数，然后在数组中将这 k 个整数所对应的二进制位设置为1，判断某个key是否存在时，还是使用 k 个hash函数对key进行散列，得到k个整数，如果这k个整数所对应的二进制位都是1，就说明这个key存在，否则，这个key不存在。</p> <p>推荐链接</p> <p><a href="https://yq.aliyun.com/articles/3607" target="_blank" rel="noopener noreferrer">大数据量处理利器：布隆过滤器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://blog.csdn.net/liebert/article/details/79737042" target="_blank" rel="noopener noreferrer">javascript实现布隆过滤器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2> <p><a href="https://www.e-learn.cn/topic/1619491" target="_blank" rel="noopener noreferrer">https://www.e-learn.cn/topic/1619491<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://blog.xhu.me/post/JS%20%E5%AE%9E%E7%8E%B0%20BitMap%20%E6%9F%A5%E8%AF%A2%E7%AE%97%E6%B3%95" target="_blank" rel="noopener noreferrer">https://blog.xhu.me/post/JS%20%E5%AE%9E%E7%8E%B0%20BitMap%20%E6%9F%A5%E8%AF%A2%E7%AE%97%E6%B3%95<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/YoFoon/FE-FACE/edit/master/blog/20200428-BitMap.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/20200914-tong-guo-localStorage-tong-yuan-fa-song-xin-xi.html" class="prev">
          通过localStorage同域发送信息
        </a></span> <span class="next"><a href="/blog/20200509-node-big-text.html">
          NODE 大文件读写
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.1274b19c.js" defer></script><script src="/assets/js/3.e5f6c01d.js" defer></script><script src="/assets/js/25.4e770138.js" defer></script><script src="/assets/js/6.da654ace.js" defer></script>
  </body>
</html>
